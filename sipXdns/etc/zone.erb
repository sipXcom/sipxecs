$TTL 1800
@       IN     SOA    ns1.<%= domain %>. root.<%= domain %>. (
                       <%= serialno %> ; serial#
                       1800            ; refresh, seconds
                       1800            ; retry, seconds
                       1800            ; expire, seconds
                       1800 )          ; minimum TTL, seconds
<% 
  dns_servers.each { |server| 
%><%= domain %>.            IN     NS     <%= server[:name] %>.
<%}

  naptr_protocols.each { |proto| 
  protoCode = 'SIP+D2' + proto[0,1].upcase  # SIP+D2T
%><%= domain %>.               IN      NAPTR   2 0 "s" "<%= protoCode %>" "" _sip._<%= proto %>.<%= domain %>.
<%} 

  # distribute traffic equally for now to each proxy
  sip_protocols.each { |proto|
    proxy_servers.each { |server| 
      if proto == 'tls'
%>_sips._tcp.<%= domain %>.     IN      SRV     10 10 5061 <%= server[:name] %>.
_sip._tls.<%= domain %>.     IN      SRV     10 10 5061 <%= server[:name] %>.
<%
      else

%>_sip._<%= proto %>.<%= domain %>.     IN      SRV     10 10 5060 <%= server[:name] %>.
<%    end
    }
  }

  registrar_servers.each { |a|
    registrar_servers.each { |b|
      # give priority to local registrar
      rr_priority = (a == b ? '10' : '20')
%>sip._tcp.rr.<%= a[:name] %>.     IN      SRV     <%= rr_priority %> 10 5070 <%= b[:name] %>.
<%  } 
  } 

  im_servers.each { |server| 
%>_xmpp-server._tcp.<%= domain %>.     IN   SRV   10  10  5269  <%= server[:name] %>.
_xmpp-client._tcp.<%= domain %>.     IN   SRV   10  10  5222  <%= server[:name] %>.
_xmpp-server._tcp.conference.<%= domain %>.     IN   SRV   10  10  5222  <%= server[:name] %>.
_xmpp-client._tcp.conference.<%= domain %>.     IN   SRV   10  10  5222  <%= server[:name] %>.
<%} 

  all_servers.each { |server| 
%><%= server[:name] %>.           IN      A       <%= server[:ipv4] %>
<%}
%>
