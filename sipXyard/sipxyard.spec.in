Name:     @PACKAGE@
Version:  @VERSION@
Release:  @PACKAGE_REVISION@

Summary: Yet Another REST Daemon (sipXyard)
License: AGPL
Vendor: Ezuce Inc.
Url: http://www.ezuce.com

Source:   %name-%version.tar.gz
Prefix:    %_prefix
BuildRoot: %{_tmppath}/%name-%version-root

BuildRequires: automake
BuildRequires: gcc-c++
BuildRequires: cppunit-devel
BuildRequires: sipxcommserverlib-devel  >= %version
BuildRequires: sipxportlib-devel        >= %version
BuildRequires: sipxtacklib-devel        >= %version
BuildRequires: leveldb-devel
BuildRequires: java-1.7.0-openjdk-devel
BuildRequires: sipxcommons >= %version
BuildRequires: sipxconfig >= %version

Requires: sipxcommserverlib  >= %version
Requires: sipxportlib        >= %version
Requires: sipxtacklib        >= %version
Requires: leveldb
Requires: sipxcommons >= %version

%description
Implementation of REST Persistence Store, Remote Configuration and Process Management


%package devel
Requires: %name
Group: Development/Libraries
Vendor: Ezuce Inc.
Summary: %name Class Library


%description devel
Class Library for %name

%prep
%setup -q

%build
%configure @SIPX_RPM_CONFIGURE_OPTIONS@
cp config.log %name.configlog
make %{_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
make DESTDIR=$RPM_BUILD_ROOT install

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(644,root,root,755)

%attr(755,root,root) %{_bindir}/sipxyard
%attr(755,root,root) %{_libdir}/libsipXyard.so*
%attr(755,root,root) %{_libdir}/yard_plugins/libConfigDumper.so*
%attr(755,root,root) %{_libdir}/yard_plugins/libProcessControl.so*
%{_sysconfdir}/sipxpbx/yard/yard-gateway.properties
%{_sysconfdir}/sipxpbx/yard/yard-gateway.xml
%{_datadir}/java/sipXecs/sipXconfig/plugins/yard-gateway-plugin.jar

%files devel
%defattr(644,root,root,755)
%{_libdir}/libsipXyard.la
%{_libdir}/yard_plugins/libConfigDumper.la
%{_libdir}/yard_plugins/libProcessControl.la
%{_includedir}/sipxyard/*

%post
setcap 'CAP_SYS_RESOURCE=+ep' %{_bindir}/sipxyard

